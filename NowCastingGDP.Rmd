---
title: "NowCasting GDP"
author: "Minhaz Khan, Navin Chandradat, Bobak Ahmar, Vincent La"
date: "14/09/2019"
output: html_document
---
The problem that we will be tackling is the prediction of the quarters of the fiscal year. To do this, we will employ a technique called 
NowCasting, which is the prediction of the current, and near future by examining data that occur at different frequencies and with 
different lags. To begin, we'll first plot the monthly and quarterly GDPs against eachother. Next, we will fit a model based on the data 
provided and examine the correlation between different months and quarters.

```{r, fig.height=3, fig.width=5}
# load required packages
library(cansim)
library(tidyverse)
library(lubridate)
library(modelr)
library(broom)
library(astsa)

#### Problem 2 ####

# plot quarterly & monthly GDP 
#This code is from the Draft
get_cansim_vector( c( 
  "monthly GDP" = "v65201210",
  "quarterly GDP" = "v1000000673") ,
    start_time = "2015-01-01" ) %>% 
  normalize_cansim_values() %>% 
  ggplot( aes( x = Date, y = VALUE, col = label ) ) +
  geom_line() + geom_point() + ylab("Chained (2012) dollars") +
  ggtitle("Problem 2: Plot of quarterly & monthly GDP")


```
The graph shows that both the monthly and quarterly GDPs increase at almost exactly the same rate. This suggests that
perhaps the two are highly correlated.


In order to get a closer look at the existing pattern, we separated the monthly and quarterly GDP and then graphed them.
```{r}
get_cansim_vector( c( 
  "monthly GDP (basic prices)" = "v65201210",
  "quarterly GDP (expend-based)" = "v62305723") ,
    start_time = "2010-01-01" ) %>% 
  normalize_cansim_values() %>% 
  ggplot( aes( x = Date, y = VALUE, col = label ) ) +
  geom_line() + geom_point() + ylab("Chained (2012) dollars")
```

```{r}
get_cansim_vector( c( 
  "monthly GDP (basic prices)" = "v65201210",
  "quarterly GDP (expend-based)" = "v62305723") ,
    start_time = "2009-01-01" ) %>% 
    normalize_cansim_values() -> ncastDF
```

```{r}
ncastDF %>% group_by(label) %>% summarise(time_mean = mean(VALUE), time_var = var(VALUE), time_med = median(VALUE))
```

```{r}
ncastDF %>% spread(label,VALUE) -> ncastSP
ncastSP
```

```{r}
glimpse(ncastDF)
ncastDF %>% filter(label == "quarterly GDP (expend-based)" & year(Date) ==2010) %>% ggplot(aes(Date,VALUE,col=label))+geom_line()

ncastDF %>% filter(label == "monthly GDP (basic prices)" & year(Date) ==2010) %>% ggplot(aes(Date,VALUE,col=label))+geom_line()
ncastDF %>% filter(label == "monthly GDP (basic prices)" & year(Date) ==2011) %>% ggplot(aes(Date,VALUE,col=label))+geom_line()
ncastDF %>% filter(label == "monthly GDP (basic prices)" & year(Date) ==2012) %>% ggplot(aes(Date,VALUE,col=label))+geom_line()
ncastDF %>% filter(label == "monthly GDP (basic prices)" & year(Date) ==2013) %>% ggplot(aes(Date,VALUE,col=label))+geom_line()
```

Now what we want to do is use a basic regression model to help us further our understanding of the data.

```{r}
#Trying to fit a linear model


ncast.1 = lm(VALUE~label+Date, data = ncastDF)
summary(ncast.1)
ggplot(ncast.1,aes(x=Date,y= VALUE,group = Date))+geom_boxplot()

```

Here, we can see that the variance between the values are more or less the same time progresses, while the mean steadily increases in an almost linear fashion.

```{r}
ncastSP %>% filter(year(Date) >= 2018 & year(Date) <= 2019) -> ncast1

ncast.1 %>% mutate(monthly = case_when(
                                  `monthly GDP (basic prices)` != NA ~ 0, TRUE ~ NA_real_))

ncast1 %>% mutate(monthly = case_when(
                                  `monthly GDP (basic prices)` == NA ~ 0, TRUE ~ `monthly GDP (basic prices)`))

apps2 %>% mutate(Price = case_when(
                              Price == 0 ~ Price, 
                              Price > 0 ~ Price/Price,
                              TRUE ~ NA_real_)) -> apps2
```
```{r}

```


